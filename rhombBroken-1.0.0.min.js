(function(d){function a(f,g,h){g=g||{};f.onload=function(){let dWidth=g.dWidth>25?10:(g.dWidth||10),dHeight=g.dHeight>25?10:(g.dHeight||10),rX=f.width/dWidth,rY=f.height/dHeight,xI=dWidth+2,yI=dHeight+2,zoomX=dWidth-g.offset?(g.offset>10?10:g.offset):8,zoomY=dHeight-g.offset?(g.offset>10?10:g.offset):8,allArr=[],contentDiv=document.createElement("div");for(let i=-1;i<=yI;i++){let levelArr=[];for(let j=-1;j<=xI;j++){let point=[j*(rX+Math.random()*rX/zoomX-rX/(2*zoomX))-rX/2,i*(rY+Math.random()*rY/zoomY-rY/(2*zoomY))-rY/2];levelArr.push(point)}allArr.push(levelArr)}contentDiv.style.position="absolute";contentDiv.style.top=c(f)+"px";contentDiv.style.left=b(f)+"px";document.getElementsByTagName("body")[0].appendChild(contentDiv);f.onclick=function(k){f.onclick=function(){};let e=k||d.event;f.style.opacity=0;for(let j=0;j<allArr.length-2;j++){let num=j%2?2:1;for(let i=num;i<allArr[j].length-1;i+=2){let topPointY=allArr[j][i][1],bottomPointY=allArr[j+2][i][1],leftPointX=allArr[j+1][i-1][0],rightPointX=allArr[j+1][i+1][0];if(topPointY>f.height){continue}let canvas=document.createElement("canvas");let ctx=canvas.getContext("2d");canvas.width=f.width;canvas.height=f.height;ctx.drawImage(f,0,0);ctx.globalCompositeOperation="destination-in";ctx.save();ctx.beginPath();ctx.moveTo(allArr[j][i][0],topPointY);ctx.lineTo(leftPointX,allArr[j+1][i-1][1]);ctx.lineTo(allArr[j+2][i][0],bottomPointY);ctx.lineTo(rightPointX,allArr[j+1][i+1][1]);ctx.closePath();ctx.fill();ctx.restore();let realCanvas=document.createElement("canvas");let realCtx=realCanvas.getContext("2d");g.time=g.time>2?2:(g.time<0?1:g.time||1);realCanvas.width=rightPointX-leftPointX;realCanvas.height=bottomPointY-topPointY;realCtx.drawImage(canvas,-leftPointX,-topPointY);realCanvas.style.left=leftPointX+"px";realCanvas.style.top=topPointY+"px";realCanvas.style.position="absolute";realCanvas.style.transition="all "+g.time+"s";contentDiv.appendChild(realCanvas);setTimeout(function(){let flyOffset=g.flyOffset||1500;realCanvas.style.transform="scale(2) rotateX("+g.rotate||360+"deg)";if(leftPointX>e.offsetX){realCanvas.style.left=leftPointX+Math.random()*flyOffset+"px"}else{realCanvas.style.left=leftPointX-Math.random()*flyOffset+"px"}if(topPointY>e.offsetY){realCanvas.style.top=topPointY+Math.random()*flyOffset+"px"}else{realCanvas.style.top=topPointY-Math.random()*flyOffset+"px"}realCanvas.style.opacity=0},1)}}setTimeout(function(){contentDiv.parentNode.removeChild(contentDiv);if(h){h(f)}},g.time*1000+1000)}}}function c(f){let offsetTop=f.offsetTop||0;return offsetTop+(f.parentNode!==null?c(f.parentNode):0)}function b(f){let offsetLeft=f.offsetLeft||0;return offsetLeft+(f.parentNode!==null?b(f.parentNode):0)}d.rhombBroken=a})(window);
